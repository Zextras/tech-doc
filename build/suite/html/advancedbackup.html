<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zextras Backup Advanced techniques &mdash; Zextras Suite 0.1-alpha documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/design-style.d53ab927f7bad3eaa42da95908504b10.min.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/suite.css" type="text/css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/design-tabs.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Zextras Mobile" href="mobile.html" />
    <link rel="prev" title="Zextras Backup Restore Strategies" href="restorestrategies.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   <a href="index.html" class="icon icon-home"> Zextras Suite
</a>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="general.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Zextras Suite Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">Zextras Backup</a></li>
<li class="toctree-l1"><a class="reference internal" href="restorestrategies.html">Zextras Backup Restore Strategies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Zextras Backup Advanced techniques</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#disaster-recovery">Disaster Recovery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-disaster">The Disaster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-can-go-wrong">What Can go Wrong</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimizing-the-chances">Minimizing the Chances</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-recovery">The Recovery</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-to-recover-your-system">How to Recover Your System</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-can-zextras-backup-help-with-recovery">How can Zextras Backup Help with Recovery?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-recovery-process">The Recovery Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#settings-and-configs">Settings and Configs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vms-and-snapshots">VMs and Snapshots</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#disaster-recovery-from-a-previous-vm-state">Disaster Recovery from a Previous VM State</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-aftermath">The Aftermath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-now">What Now?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unrestorable-items">Unrestorable Items</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-check-if-all-of-my-items-have-been-restored">How can I check if all of my items have been restored?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#skipped-items-vs-unrestored-items">Skipped Items vs. Unrestored Items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#why-have-some-of-my-items-not-been-restored">Why have some of my items not been restored?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-identify-unrestored-items">How Can I Identify Unrestored Items?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#identifying-unrestorable-items-through-the-cli">Identifying Unrestorable Items through the CLI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#identifying-unrestorable-items-through-the-zimbra-webclient">Identifying Unrestorable Items through the Zimbra WebClient</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-restore-unrestored-items">How Can I Restore Unrestored Items?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#items-not-restored-because-of-a-read-error">Items Not Restored because of a Read Error</a></li>
<li class="toctree-l4"><a class="reference internal" href="#items-not-restored-because-identified-as-broken-items">Items Not Restored because Identified as Broken Items</a></li>
<li class="toctree-l4"><a class="reference internal" href="#items-not-restored-because-identified-as-invalid-items">Items Not Restored because Identified as Invalid Items</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#taking-additional-and-offsite-backups-of-zextras-backups-datastore">Taking Additional and Offsite Backups of Zextras Backup’s Datastore</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#who-watches-the-watchmen">Who Watches the Watchmen?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#making-an-additional-backup-of-zextras-backups-datastore">Making an Additional Backup of Zextras Backup’s Datastore</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storing-your-zextras-backups-datastore-backup-offsite">Storing Your Zextras Backup’s Datastore Backup Offsite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-offsite-backup-f-a-q">Additional/Offsite Backup F.A.Q.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multistore-information">Multistore Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zextras-backup-in-a-multistore-environment">Zextras Backup in a Multistore Environment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#command-execution-in-a-multistore-environment">Command Execution in a Multistore Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backup-and-restore">Backup and Restore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-and-import">Export and Import</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-docheckshares-and-dofixshares-commands">The <code class="docutils literal notranslate"><span class="pre">doCheckShares</span></code> and <code class="docutils literal notranslate"><span class="pre">doFixShares</span></code> Commands</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#operation-queue-and-queue-management">Operation Queue and Queue Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zextras-backups-operation-queue">Zextras Backup’s Operation Queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-queue-management">Operation Queue Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#through-the-administration-console">Through the Administration Console</a></li>
<li class="toctree-l4"><a class="reference internal" href="#through-the-cli">Through the CLI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cos-level-backup-management">COS-level Backup Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-cos-level-backup-management">What is COS-level Backup Management?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-does-cos-level-backup-management-work">How Does COS-level Backup Management Work?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-happens-if-i-disable-the-zextras-backup-module-for-a-class-of-service">What happens if I disable the Zextras Backup Module for a Class of Service?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-is-the-backup-enabled-backup-disabled-information-saved">How is the <code class="docutils literal notranslate"><span class="pre">backup</span> <span class="pre">enabled</span></code>/<code class="docutils literal notranslate"><span class="pre">backup</span> <span class="pre">disabled</span></code> information saved?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mobile.html">Zextras Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="powerstore.html">Zextras Powerstore</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin.html">Zextras Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="drive.html">Zextras Drive</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Zextras Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Zextras Auth</a></li>
<li class="toctree-l1"><a class="reference internal" href="team.html">Zextras Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI</a></li>
</ul>

<hr />
<ul>
  <li class="toctree-l1">
    <a href="/landing/html/home.html">Back to
      Zextras Documentation hub
    </a>
  </li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Zextras Suite</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Zextras Backup Advanced techniques</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>All content is provisional and is meant <strong>only</strong> to showcase
the feature of the new framework.</p>
</div>
<section id="zextras-backup-advanced-techniques">
<span id="backup-advanced-techniques"></span><h1>Zextras Backup Advanced techniques<a class="headerlink" href="#zextras-backup-advanced-techniques" title="Permalink to this headline"></a></h1>
<section id="disaster-recovery">
<span id="id1"></span><h2>Disaster Recovery<a class="headerlink" href="#disaster-recovery" title="Permalink to this headline"></a></h2>
<section id="the-disaster">
<span id="id2"></span><h3>The Disaster<a class="headerlink" href="#the-disaster" title="Permalink to this headline"></a></h3>
<section id="what-can-go-wrong">
<span id="id3"></span><h4>What Can go Wrong<a class="headerlink" href="#what-can-go-wrong" title="Permalink to this headline"></a></h4>
<p>To classify a problem as a <code class="docutils literal notranslate"><span class="pre">Disaster</span></code>, one or more of the following
must happened:</p>
<ul class="simple">
<li><p>Hardware failure of one or more vital filesystems (such as / or
/opt/zimbra/)</p></li>
<li><p>Contents of a vital filesystem made unusable by internal or external
factors (like a careless <strong>rm *</strong> or an external intrusion)</p></li>
<li><p>Hardware failure of the physical machine hosting the Zimbra service
or of the related virtualization infrastructure</p></li>
<li><p>A critical failure on a software or OS update/upgrade</p></li>
</ul>
</section>
<section id="minimizing-the-chances">
<span id="id4"></span><h4>Minimizing the Chances<a class="headerlink" href="#minimizing-the-chances" title="Permalink to this headline"></a></h4>
<p>Some suggestions to minimize the chances of a disaster:</p>
<ul class="simple">
<li><p>Always keep vital filesystems on different drives (namely /,
/opt/zimbra/ and your Zextras Backup path)</p></li>
<li><p>Use a monitoring/alerting tool for your server to become aware of
problems as soon as they appear</p></li>
<li><p>Carefully plan your updates and migrations</p></li>
</ul>
</section>
</section>
<section id="the-recovery">
<span id="id5"></span><h3>The Recovery<a class="headerlink" href="#the-recovery" title="Permalink to this headline"></a></h3>
<section id="how-to-recover-your-system">
<span id="id6"></span><h4>How to Recover Your System<a class="headerlink" href="#how-to-recover-your-system" title="Permalink to this headline"></a></h4>
<p>The recovery of a system is divided into 2 steps:</p>
<ul class="simple">
<li><p>Base system recovery (OS installation and configuration, Zimbra
installation and base configuration)</p></li>
<li><p>Data recovery (reimporting the last available data to the Zimbra
server, including domain and user configurations, COS data and
mailbox contents)</p></li>
</ul>
</section>
<section id="how-can-zextras-backup-help-with-recovery">
<span id="id7"></span><h4>How can Zextras Backup Help with Recovery?<a class="headerlink" href="#how-can-zextras-backup-help-with-recovery" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Import</span> <span class="pre">Backup</span></code> feature of Zextras Backup provides an easy and
safe way to perform step 2 of a recovery.</p>
<p>Using the old server’s backup path as the import path allows you to
restore a basic installation of Zimbra to the last valid moment of your
old server.</p>
</section>
<section id="the-recovery-process">
<span id="id8"></span><h4>The Recovery Process<a class="headerlink" href="#the-recovery-process" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>Install Zimbra on a new server and configure the Server and Global
settings.</p></li>
<li><p>Install Zextras Suite on the new server.</p></li>
<li><p>Mount the backup folder of the old server onto the new one. If this
is not available, use the last external backup available or the
latest copy of either.</p></li>
<li><p>Begin an External Restore on the new server using the following CLI
command:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">zxsuite</span> <span class="pre">backup</span> <span class="pre">doExternalRestore</span> <span class="pre">/path/to/the/old/store</span></code></p>
<ul class="simple">
<li><p>The External Restore operation will immediately create the domains,
accounts and distribution lists, so as soon as the first part of the
Restore is completed (check your Zextras Suite Notifications), the
system will be ready for your users. Emails and other mailbox items
will be restored afterwards.</p></li>
</ul>
</section>
<section id="settings-and-configs">
<span id="id9"></span><h4>Settings and Configs<a class="headerlink" href="#settings-and-configs" title="Permalink to this headline"></a></h4>
<p>Server and Global settings are backed up but are not restored
automatically. Zextras Backup’s high-level integration with Zimbra
allows you to restore your data to a server with a different OS/Zimbra
Release/Networking/Storage setup without any constraints other than the
minimum Zimbra version required to run Zextras Suite.</p>
<p>Whether you wish to create a perfect copy of the old server or just take
a cue from the old server’s settings to adapt those to a new
environment, Zextras Backup comes with a very handy CLI command:
<code class="docutils literal notranslate"><span class="pre">getServerConfig</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite backup getServerConfig
command getServerConfig requires more parameters


Syntax:
   zxsuite backup getServerConfig {standard|customizations} [attr1 value1 [attr2 value2...


PARAMETER LIST


NAME              TYPE               EXPECTED VALUES                       DEFAULT
type(M)           Multiple choice    standard|customizations
date(O)           String             `dd/MM/yyyy HH:mm:ss`|&quot;last&quot;|&quot;all&quot;
backup_path(O)    Path                                                     /opt/zimbra/backup/ng/
file(O)           String             Path to backup file
query(O)          String             section/id/key
verbose(O)        String                                                   false
colors(O)         String                                                   false


(M) == mandatory parameter, (O) == optional parameter


Usage example:


zxsuite backup getserverconfig standard date last
 Display the latest backup data for Server and Global configuration.
zxsuite backup getserverconfig standard file /path/to/backup/file
 Display the contents of a backup file instead of the current server backup.
zxsuite backup getserverconfig standard date last query zimlets/com_zimbra_ymemoticons colors true verbose true
 Displays all settings for the com_zimbra_ymemoticons zimlet, using colored output and high verbosity.
</pre></div>
</div>
<p>Specifically, this will display the latest backed up configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zxsuite</span> <span class="n">backup</span> <span class="n">getServerConfig</span> <span class="n">standard</span> <span class="n">backup_path</span> <span class="o">/</span><span class="n">your</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">path</span><span class="o">/</span> <span class="n">date</span> <span class="n">last</span> <span class="n">query</span> <span class="o">/</span> <span class="o">|</span> <span class="n">less</span>
</pre></div>
</div>
<p>You can change the <code class="docutils literal notranslate"><span class="pre">query</span></code> argument to display specific settings, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite backup getServerConfig standard date last backup_path /opt/zimbra/backup/ng/ query serverConfig/zimbraMailMode/test.example.com


config date_______________________________________________________________________________________________28/02/2014 04:01:14 CET
test.example.com____________________________________________________________________________________________________________both
</pre></div>
</div>
<p>The {zimbrahome}/conf/ and {zimbrahome}/postfix/conf/ directories are
backed up as well:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite backup getServerConfig customizations date last verbose true
ATTENTION: These files contain the directories {zimbraHome}/conf/ and {zimbraHome}/postfix/conf/ compressed into a single archive.
           Restore can only be performed manually. Do it only if you know what you&#39;re doing.




        archives


                filename                                                    customizations_28_02_14#04_01_14.tar.gz
                path                                                        /opt/zimbra/backup/ng/server/
                modify date                                                 28/02/2014 04:01:14 CET
</pre></div>
</div>
</section>
</section>
<section id="vms-and-snapshots">
<span id="id10"></span><h3>VMs and Snapshots<a class="headerlink" href="#vms-and-snapshots" title="Permalink to this headline"></a></h3>
<p>Thanks to the advent of highly evolved virtualization solutions in the
past years, virtual machines are now the most common way to deploy
server solutions such as Zimbra Collaboration Suite.</p>
<p>Most hypervisors feature customizable snapshot capabilities and
snapshot-based VM backup systems. In case of a disaster, it’s always
possible to roll back to the latest snapshot and import the missing data
using the <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">Restore</span></code> feature of Zextras Backup - using the
server’s backup path as the import path.</p>
<section id="disaster-recovery-from-a-previous-vm-state">
<span id="id11"></span><h4>Disaster Recovery from a Previous VM State<a class="headerlink" href="#disaster-recovery-from-a-previous-vm-state" title="Permalink to this headline"></a></h4>
<p>Snapshot-based backup systems allow you to keep a <code class="docutils literal notranslate"><span class="pre">frozen</span></code> copy of a
VM in a valid state and rollback to it at will. To 100% ensure data
consistency, it’s better to take snapshot copies of switched off VMs,
but this is not mandatory.</p>
<p><strong>When using these kinds of systems, it’s vital to make sure that the
Backup Path isn’t either part of the snapshot (e.g. by setting the vdisk
to `Independent Persistent in VMWare ESX/i) or altered in any way when
rolling back in order for the missing data to be available for import.</strong></p>
<p>To perform a disaster recovery from a previous machine state with
Zextras Backup, you need to:</p>
<ul class="simple">
<li><p>Restore the last valid backup into a separate (clone) VM in an
isolated network, making sure that users can’t access it and that
both incoming and outgoing emails are not delivered.</p></li>
<li><p>Switch on the clone and wait for Zimbra to start.</p></li>
<li><p>Disable Zextras Backup’s RealTime Scanner.</p></li>
<li><p>Connect the Virtual Disk containing the untampered Backup Path to the
clone and mount it (on a different path).</p></li>
<li><p>Start an External Restore using the Backup Path as the Import Path.</p></li>
</ul>
<p>Doing so will parse all items in the Backup Path and import the missing
ones, speeding up the disaster recovery. These steps can be repeated as
many time as needed as long as user access and mail traffic is
inhibited.</p>
<p>After the restore is completed, make sure that everything is functional
and restore user access and mail traffic.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>At the end of the operation, you can check that the configuration of
the new mailbox is the same by running the command <code class="docutils literal notranslate"><span class="pre">zxsuite</span> <span class="pre">config</span>
<span class="pre">dump</span></code> (See the <a class="reference external" href="../cli.xml#config_dump_account">full reference</a>
of all its sub-commands).</p>
</div>
</section>
</section>
<section id="the-aftermath">
<span id="id12"></span><h3>The Aftermath<a class="headerlink" href="#the-aftermath" title="Permalink to this headline"></a></h3>
<section id="what-now">
<span id="id13"></span><h4>What Now?<a class="headerlink" href="#what-now" title="Permalink to this headline"></a></h4>
<p>Should you need to restore any content from before the disaster, just
initialize a new Backup Path and store the old one.</p>
</section>
</section>
</section>
<section id="unrestorable-items">
<span id="id14"></span><h2>Unrestorable Items<a class="headerlink" href="#unrestorable-items" title="Permalink to this headline"></a></h2>
<section id="how-can-i-check-if-all-of-my-items-have-been-restored">
<span id="id15"></span><h3>How can I check if all of my items have been restored?<a class="headerlink" href="#how-can-i-check-if-all-of-my-items-have-been-restored" title="Permalink to this headline"></a></h3>
<p>It’s very easy. Check the appropriate <code class="docutils literal notranslate"><span class="pre">Operation</span> <span class="pre">Completed</span></code>
notification you received as soon as the restore operation finished. It
can be viewed in the <code class="docutils literal notranslate"><span class="pre">Notifications</span></code> section of the Administration
Zimlet, and it’s also emailed to the address you specified in the
<code class="docutils literal notranslate"><span class="pre">Core</span></code> section of the Administration Zimlet as the <code class="docutils literal notranslate"><span class="pre">Notification</span>
<span class="pre">E-Mail</span> <span class="pre">recipient</span> <span class="pre">address</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">skipped</span> <span class="pre">items</span></code> section contains a per-account list of unrestored
items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="o">-</span> <span class="n">stats</span> <span class="o">-</span>
<span class="n">Restored</span> <span class="n">Items</span><span class="p">:</span> <span class="mi">15233</span>
<span class="n">Skipped</span> <span class="n">Items</span><span class="p">:</span>  <span class="mi">125</span>
<span class="n">Unrestored</span> <span class="n">Items</span><span class="p">:</span> <span class="mi">10</span>

<span class="o">-</span> <span class="n">unrestored</span> <span class="n">items</span> <span class="o">-</span>
<span class="n">account</span><span class="p">:</span> <span class="n">account1</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>
<span class="n">unrestored</span> <span class="n">items</span><span class="p">:</span> <span class="mi">1255</span><span class="p">,</span><span class="mi">1369</span>

<span class="n">account</span><span class="p">:</span> <span class="n">account2</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>
<span class="n">unrestored</span> <span class="n">items</span><span class="p">:</span> <span class="mi">49965</span>

<span class="n">account</span><span class="p">:</span> <span class="n">account14</span><span class="nd">@example</span><span class="o">.</span><span class="n">com</span>
<span class="n">unrestored</span> <span class="n">items</span><span class="p">:</span> <span class="mi">856</span><span class="p">,</span><span class="mi">13339</span><span class="p">,</span><span class="mi">45200</span><span class="p">,</span> <span class="mi">45655</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<section id="skipped-items-vs-unrestored-items">
<span id="id16"></span><h4>Skipped Items vs. Unrestored Items<a class="headerlink" href="#skipped-items-vs-unrestored-items" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Skipped</span></code> item: An item that has already been restored, either
during the current restore or in a previous one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Unrestored</span></code> item: An item that has not been restored due to an
issue in the restore process.</p></li>
</ul>
</section>
</section>
<section id="why-have-some-of-my-items-not-been-restored">
<span id="id17"></span><h3>Why have some of my items not been restored?<a class="headerlink" href="#why-have-some-of-my-items-not-been-restored" title="Permalink to this headline"></a></h3>
<p>There are different possible causes, the most common of which are:</p>
<ul class="simple">
<li><p><strong>Read Error</strong>: Either the raw item or the metadata file is not
readable due to an I/O exception or a permission issue.</p></li>
<li><p><strong>Broken item</strong>: Both the the raw item or the metadata file are
readable by Zextras Backup but their content is broken/corrupted.</p></li>
<li><p><strong>Invalid item</strong>: Both the the raw item or the metadata file are
readable and the content is correct, but Zimbra refuses to inject the
item.</p></li>
</ul>
</section>
<section id="how-can-i-identify-unrestored-items">
<span id="id18"></span><h3>How Can I Identify Unrestored Items?<a class="headerlink" href="#how-can-i-identify-unrestored-items" title="Permalink to this headline"></a></h3>
<p>There are two ways to do so: via the CLI and via the Zimbra Web Client.
The first way can be used to search for the item within the
backup/import path, and the second can be used to view the items in the
source server.</p>
<section id="identifying-unrestorable-items-through-the-cli">
<span id="id19"></span><h4>Identifying Unrestorable Items through the CLI<a class="headerlink" href="#identifying-unrestorable-items-through-the-cli" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">getItem</span></code> CLI command can display an item and the related
metadata, extracting all information from a backup path/external backup.</p>
<p>The syntax of the command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">zxsuite</span> <span class="n">backup</span> <span class="n">getItem</span> <span class="p">{</span><span class="n">account</span><span class="p">}</span> <span class="p">{</span><span class="n">item</span><span class="p">}</span> <span class="p">[</span><span class="n">attr1</span> <span class="n">value1</span> <span class="p">[</span><span class="n">attr2</span> <span class="n">value2</span><span class="o">...</span>

<span class="n">PARAMETER</span> <span class="n">LIST</span>

<span class="n">NAME</span>              <span class="n">TYPE</span>               <span class="n">EXPECTED</span> <span class="n">VALUES</span>            <span class="n">DEFAULT</span>
<span class="n">account</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>        <span class="n">Account</span> <span class="n">Name</span><span class="o">/</span><span class="n">ID</span>
<span class="n">item</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>           <span class="n">Integer</span>
<span class="n">backup_path</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>    <span class="n">Path</span>                                          <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">ng</span><span class="o">/</span>
<span class="n">dump_blob</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>      <span class="n">Boolean</span>            <span class="n">true</span><span class="o">|</span><span class="n">false</span>                 <span class="n">false</span>
<span class="n">date</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>           <span class="n">Date</span>               <span class="n">dd</span><span class="o">/</span><span class="n">mm</span><span class="o">/</span><span class="n">yyyy</span> <span class="n">hh</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span><span class="o">|</span><span class="nb">all</span>    <span class="n">last</span>

<span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">==</span> <span class="n">mandatory</span> <span class="n">parameter</span><span class="p">,</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span> <span class="o">==</span> <span class="n">optional</span> <span class="n">parameter</span>
</pre></div>
</div>
<p>To extract the raw data and metadata information of the item whose
itemID is <em>49965</em> belonging to <em>account2&#64;example.com</em> ,also including
the full dump of the item’s BLOB, the command would be:</p>
<p><code class="docutils literal notranslate"><span class="pre">zxsuite backup getItem account2&#64;example.com 49965 dump_blob true</span></code></p>
</section>
<section id="identifying-unrestorable-items-through-the-zimbra-webclient">
<span id="id20"></span><h4>Identifying Unrestorable Items through the Zimbra WebClient<a class="headerlink" href="#identifying-unrestorable-items-through-the-zimbra-webclient" title="Permalink to this headline"></a></h4>
<p>The comma separated list of unrestored items displayed in the
<code class="docutils literal notranslate"><span class="pre">Operation</span>
<span class="pre">Complete</span></code> notification can be used as a search argument in the Zimbra
Web Client to perform an item search.</p>
<p>To do so:</p>
<ul class="simple">
<li><p>Log into the Zimbra Administration Console in the source server.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">View</span> <span class="pre">Mail</span></code> feature to access the account containing the
unrestored items.</p></li>
<li><p>In the search box, enter <strong>item:</strong> followed by the comma separated
list of itemIDs.</p></li>
</ul>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">e.g.</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">item: 856,13339,45200,45655</span></code></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember that any search is executed only within the tab it is
executed, so if you are running the search from the <code class="docutils literal notranslate"><span class="pre">Email</span></code> tab and
get no results try to run the same search in the <code class="docutils literal notranslate"><span class="pre">Address</span> <span class="pre">Book</span></code>,
<code class="docutils literal notranslate"><span class="pre">Calendar</span></code>, <code class="docutils literal notranslate"><span class="pre">Tasks</span></code> and <code class="docutils literal notranslate"><span class="pre">Drive</span></code> tabs.</p>
</div>
</section>
</section>
<section id="how-can-i-restore-unrestored-items">
<span id="id21"></span><h3>How Can I Restore Unrestored Items?<a class="headerlink" href="#how-can-i-restore-unrestored-items" title="Permalink to this headline"></a></h3>
<p>An item not being restored is a clear sign of an issue, either with the
item itself or with your current Zimbra setup. In some cases, there are
good chances of being able to restore an item even if it was not
restored on the first try.</p>
<p>In the following paragraphs, you will find a collections of tips and
tricks that can be helpful when dealing with different kinds of
unrestorable items.</p>
<section id="items-not-restored-because-of-a-read-error">
<span id="id22"></span><h4>Items Not Restored because of a Read Error<a class="headerlink" href="#items-not-restored-because-of-a-read-error" title="Permalink to this headline"></a></h4>
<p>A dutiful distinction must be done about the read errors that can cause
items not to be restored:</p>
<ul class="simple">
<li><p><strong>hard</strong> errors: Hardware failures and all other <code class="docutils literal notranslate"><span class="pre">destructive</span></code>
errors that cause an unrecoverable data loss.</p></li>
<li><p><strong>soft</strong> errors: <code class="docutils literal notranslate"><span class="pre">non-destructive</span></code> errors such as wrong
permissions, filesystem errors, RAID issues (e.g.: broken RAID1
mirroring), etc.</p></li>
</ul>
<p>While there is nothing much to do about hard errors, you can prevent or
mitigate soft errors by following these guidelines:</p>
<ul class="simple">
<li><p>Run a filesystem check.</p></li>
<li><p>If using a RAID disk setup, check the array for possible issues
(depending on RAID level).</p></li>
<li><p>Make sure that the ‘zimbra’ user has r/w access to the backup/import
path, all its subfolders and all thereby contained files.</p></li>
<li><p>Carefully check the link quality of network-shared filesystems. If
link quality is poor, consider transferring the data with rsync.</p></li>
<li><p>If using SSHfs to remotely mount the backup/import path, make sure to
run the mount command as root using the <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">allow_other</span></code> option.</p></li>
</ul>
</section>
<section id="items-not-restored-because-identified-as-broken-items">
<span id="id23"></span><h4>Items Not Restored because Identified as Broken Items<a class="headerlink" href="#items-not-restored-because-identified-as-broken-items" title="Permalink to this headline"></a></h4>
<p>Unfortunately, this is the worst category of unrestored items in terms
of <code class="docutils literal notranslate"><span class="pre">salvageability</span></code>.</p>
<p>Based on the degree of corruption of the item, it might be possible to
recover either a previous state or the raw object (this is only valid
for emails). To identify the degree of corruption, use the <code class="docutils literal notranslate"><span class="pre">getItem</span></code>
CLI command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">zxsuite</span> <span class="n">backup</span> <span class="n">getItem</span> <span class="p">{</span><span class="n">account</span><span class="p">}</span> <span class="p">{</span><span class="n">item</span><span class="p">}</span> <span class="p">[</span><span class="n">attr1</span> <span class="n">value1</span> <span class="p">[</span><span class="n">attr2</span> <span class="n">value2</span><span class="o">...</span>

<span class="n">PARAMETER</span> <span class="n">LIST</span>

<span class="n">NAME</span>              <span class="n">TYPE</span>               <span class="n">EXPECTED</span> <span class="n">VALUES</span>            <span class="n">DEFAULT</span>
<span class="n">account</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>        <span class="n">Account</span> <span class="n">Name</span><span class="o">/</span><span class="n">ID</span>
<span class="n">item</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>           <span class="n">Integer</span>
<span class="n">backup_path</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>    <span class="n">Path</span>                                          <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span><span class="n">ng</span><span class="o">/</span>
<span class="n">dump_blob</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>      <span class="n">Boolean</span>            <span class="n">true</span><span class="o">|</span><span class="n">false</span>                 <span class="n">false</span>
<span class="n">date</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>           <span class="n">Date</span>               <span class="n">dd</span><span class="o">/</span><span class="n">mm</span><span class="o">/</span><span class="n">yyyy</span> <span class="n">hh</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span><span class="o">|</span><span class="nb">all</span>    <span class="n">last</span>

<span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">==</span> <span class="n">mandatory</span> <span class="n">parameter</span><span class="p">,</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span> <span class="o">==</span> <span class="n">optional</span> <span class="n">parameter</span>
</pre></div>
</div>
<p>Searching for the broken item, setting the <code class="docutils literal notranslate"><span class="pre">backup_path</span></code> parameter to
the import path and the <code class="docutils literal notranslate"><span class="pre">date</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">all</span></code>, will display all
valid states for the item.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite backup getItem admin@example.com 24700 backup_path /mnt/import/ date all
       itemStates
               start_date                                                  12/07/2013 16:35:44
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  12/07/2013 17:04:33
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  15/07/2013 10:03:26
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
</pre></div>
</div>
<p>If the item is an email, you will be able to recover a standard <code class="docutils literal notranslate"><span class="pre">.eml</span></code>
file through the following steps:</p>
<ul class="simple">
<li><p>Identify the latest valid state</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">import</span><span class="o">/</span><span class="n">items</span><span class="o">/</span><span class="n">c0</span><span class="o">/</span><span class="n">c0</span><span class="p">,</span><span class="n">gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo</span><span class="p">,</span><span class="n">pMmQ</span><span class="o">=</span>
              <span class="n">start_date</span>                                                  <span class="mi">15</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2013</span> <span class="mi">10</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">26</span>
              <span class="nb">type</span>                                                        <span class="n">message</span>
              <span class="n">deleted</span>                                                     <span class="n">true</span>
              <span class="n">blob</span> <span class="n">path</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">import</span><span class="o">/</span><span class="n">items</span><span class="o">/</span><span class="n">c0</span><span class="o">/</span><span class="n">c0</span><span class="p">,</span><span class="n">gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo</span><span class="p">,</span><span class="n">pMmQ</span><span class="o">=</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Identify the <code class="docutils literal notranslate"><span class="pre">blob</span> <span class="pre">path</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</span></code></p>
<ul class="simple">
<li><p>Use gzip to uncompress the BLOB file into an <code class="docutils literal notranslate"><span class="pre">.eml</span></code> file</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ gunzip -c /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ= &gt; /tmp/restored.eml

zimbra@test:~$ cat /tmp/restored.eml

Return-Path: zimbra@test.example.com

Received: from test.example.com (LHLO test.example.com) (192.168.1.123)
by test.example.com with LMTP; Fri, 12 Jul 2013 16:35:43 +0200 (CEST)

Received: by test.example.com (Postfix, from userid 1001) id 4F34A120CC4;
Fri, 12 Jul 2013 16:35:43 +0200 (CEST)
To: admin@example.com
From: admin@example.com
Subject: Service mailboxd started on test.example.com
Message-Id: &lt;20130712143543.4F34A120CC4@test.example.com&gt;
Date: Fri, 12 Jul 2013 16:35:43 +0200 (CEST)

Jul 12 16:35:42 test zmconfigd[14198]: Service status change: test.example.com mailboxd changed from stopped to running
</pre></div>
</div>
<ul class="simple">
<li><p>Done! You can now import the <code class="docutils literal notranslate"><span class="pre">.eml</span></code> file into the appropriate
mailbox using your favorite client.</p></li>
</ul>
</section>
<section id="items-not-restored-because-identified-as-invalid-items">
<span id="id24"></span><h4>Items Not Restored because Identified as Invalid Items<a class="headerlink" href="#items-not-restored-because-identified-as-invalid-items" title="Permalink to this headline"></a></h4>
<p>An item is identified as <code class="docutils literal notranslate"><span class="pre">Invalid</span></code> when, albeit being formally
correct, is discarded by Zimbra’s LMTP Validator upon injection. This is
common when importing items created on an older version of Zimbra to a
newer one, Validation rules are updated very often, so not all messages
considered valid by a certain Zimbra version are still considered valid
by a newer version.</p>
<p>If you experienced a lot of unrestored items during an import, it might
be a good idea to momentarily disable the LMTP validator and repeat the
import:</p>
<ul class="simple">
<li><p>To disable Zimbra’s LMTP Validator, run the following command as the
Zimbra user:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">zmlocalconfig -e zimbra_lmtp_validate_messages=false</span></code></p>
<ul class="simple">
<li><p>Once the import is completed, you can enable the LMTP validator
running</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">zmlocalconfig -e zimbra_lmtp_validate_messages=true</span></code></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is a <code class="docutils literal notranslate"><span class="pre">dirty</span></code> workaround, as items deemed invalid by the LMTP
validator might cause display or mobile synchronization errors. Use
at your own risk.</p>
</div>
</section>
</section>
</section>
<section id="taking-additional-and-offsite-backups-of-zextras-backups-datastore">
<span id="id25"></span><h2>Taking Additional and Offsite Backups of Zextras Backup’s Datastore<a class="headerlink" href="#taking-additional-and-offsite-backups-of-zextras-backups-datastore" title="Permalink to this headline"></a></h2>
<section id="who-watches-the-watchmen">
<span id="id26"></span><h3>Who Watches the Watchmen?<a class="headerlink" href="#who-watches-the-watchmen" title="Permalink to this headline"></a></h3>
<p>Having backup systems is a great safety measure against data loss, but
each backup system must be part of a broader <code class="docutils literal notranslate"><span class="pre">backup</span> <span class="pre">strategy</span></code> to
ensure the highest possible level of reliability. The lack of a proper
backup strategy gives a false sense of security, while actually turning
even the best backup systems in the world into yet another breaking
point.</p>
<p>Devising a backup strategy is no easy matter, and at some point you will
most likely be confronted with the following question:
<strong>``What if I lose the data I
backed up?``</strong>. The chances of this happening ultimately only depend on
how you make and manage your backups. For example, it’s more likely that
you will lose all of your backed up data if you store both your data and
your backups in a same, single SATA-II disk than if you store your
backed up data on a dedicated SAN using a RAID 1+0 setup.</p>
<p>Here are some suggestions and best practices to improve your backup
strategy by making a backup of the Backup NG’s datastore and storing it
offsite.</p>
</section>
<section id="making-an-additional-backup-of-zextras-backups-datastore">
<span id="id27"></span><h3>Making an Additional Backup of Zextras Backup’s Datastore<a class="headerlink" href="#making-an-additional-backup-of-zextras-backups-datastore" title="Permalink to this headline"></a></h3>
<p>In order to minimise the possible loss of data, a backup can take
advantage of the well-known database properties called <strong>ACID</strong>, that
guarantee data validity and integrity.</p>
<ul class="simple">
<li><p><strong>Atomicity</strong>: Any transaction is committed and written to the disk
only when completed.</p></li>
<li><p><strong>Consistency</strong>: Any committed transaction is valid, and no invalid
transaction will be committed and written to the disk.</p></li>
<li><p><strong>Isolation</strong>: All transactions are executed sequentially so that no
more than 1 transaction can affect the same item at once.</p></li>
<li><p><strong>Durability</strong>: Once a transaction is committed, it will stay so even
in case of a crash (e.g. power loss or hardware failure).</p></li>
</ul>
<p>By respecting these properties, it’s very easy to make a backup of the
Datastore and make sure of the content’s integrity and validity. The
best (and easiest) way to do so is by using the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> software,
designed around an algorithm that only transfers <em>deltas</em> (i.e., what
actually changed) instead of the whole data, and works incrementally.
Specific options and parameters depend on many factors, such as the
amount of data to be synced and the storage in use, while connecting to
an rsync daemon instead of using a remote shell as a transport is
usually much faster in transferring the data.</p>
<p>You won’t need to stop Zimbra or the Real Time Scanner to make an
additional backup of Zextras Backup’s datastore using rsync, and, thanks
to the ACID properties, you will be always able to stop the sync at any
time and reprise it at a later point.</p>
</section>
<section id="storing-your-zextras-backups-datastore-backup-offsite">
<span id="id28"></span><h3>Storing Your Zextras Backup’s Datastore Backup Offsite<a class="headerlink" href="#storing-your-zextras-backups-datastore-backup-offsite" title="Permalink to this headline"></a></h3>
<p>As seen in the previous section, making a backup of Zextras Backup’s
Datastore is very easy, and the use of rsync makes it just as easy to
store your backup in a remote location.</p>
<p>To optimize your backup strategy when dealing with this kind of setup,
the following best practices are recommended:</p>
<ul class="simple">
<li><p>If you schedule your rsync backups, make sure that you leave enough
time between an rsync instance and the next one in order for the
transfer to be completed.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">--delete</span></code> options so that files that have been deleted in
the source server are deleted in the destination server to avoid
inconsistencies.</p>
<ul>
<li><p>If you notice that using the <code class="docutils literal notranslate"><span class="pre">--delete</span></code> option takes too much
time, schedule two different rsync instances: one with
<code class="docutils literal notranslate"><span class="pre">--delete</span></code> to be run after the weekly purge and one without this
option.</p></li>
</ul>
</li>
<li><p>Make sure you transfer the <em>whole folder tree recursively</em>, starting
from Zextras Backup’s Backup Path. This includes server config
backups and mapfiles.</p></li>
<li><p>Make sure the destination filesystem is <em>case sensitive</em> (just as
Backup NG’s Backup Path must be).</p></li>
<li><p>If you plan to restore directly from the remote location, make sure
that the <em>zimbra</em> user on your server has read and write permissions
on the transferred data.</p></li>
<li><p>Expect to experience slowness if your transfer speed is much higher
than your storage throughput (or vice versa).</p></li>
</ul>
</section>
<section id="additional-offsite-backup-f-a-q">
<span id="additionaloffsite-backup-f-a-q"></span><h3>Additional/Offsite Backup F.A.Q.<a class="headerlink" href="#additional-offsite-backup-f-a-q" title="Permalink to this headline"></a></h3>
<p>Why shouldn’t I use the <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">Backup</span></code> feature of Zextras Backup
instead of rsync?</p>
<p>For many reasons:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">Backup</span></code> feature is designed to perform migrations. It
exports a <code class="docutils literal notranslate"><span class="pre">snapshot</span></code> that is an end in itself and was not designed
to be managed incrementally. Each time an Export Backup is run, it’ll
probably take just as much time as the previous one, while using
rsync is much more time-efficient.</p></li>
<li><p>Being a Zextras Backup operation, any other operation started while
the Export Backup is running will be queued until the Export Backup
is completed.</p></li>
<li><p>An <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">Backup</span></code> operation has a higher impact on system
resources than an rsync.</p></li>
<li><p>Should you need to stop an Export Backup operation, you won’t be able
to reprise it, and you’ll need to start from scratch.</p></li>
</ul>
<p>Can I use this for Disaster Recovery?</p>
<p>Yes. Obviously, if your Backup Path is still available. it’s better to
use that, as it will restore all items and settings to the last valid
state. However, should your Backup Path be lost, you’ll be able to use
your additional/offsite backup.</p>
<p>Can I use this to restore data on the server the backup copy belongs to?</p>
<p>Yes, but not through the <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">Restore</span></code> operation, since item and
folder IDs are the same.</p>
<p>The most appropriate steps to restore data from a copy of the backup
path to the very same server are as follows:</p>
<ul class="simple">
<li><p>Stop the RealTime Scanner.</p></li>
<li><p>Change the Backup Path to the copy you wish to restore your data
from.</p></li>
<li><p>Run either <code class="docutils literal notranslate"><span class="pre">Restore</span> <span class="pre">on</span> <span class="pre">New</span> <span class="pre">Account</span></code> or a
<code class="docutils literal notranslate"><span class="pre">Restore</span> <span class="pre">Deleted</span> <span class="pre">Account</span></code>.</p></li>
<li><p>Once the restore is over, change the backup path to the original one.</p></li>
<li><p>Start the RealTime Scanner. A SmartScan will be triggered to update
the backup data.</p></li>
</ul>
<p>Can I use this to create an Active/Standby infrastructure?</p>
<p>No, because the <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">Restore</span></code> operation does not perform any
deletions. By running several External Restores, you’ll end up filling
up your mailboxes with unwanted content, since items deleted from the
original mailbox will not be deleted on the <code class="docutils literal notranslate"><span class="pre">standby</span></code> server.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">External</span> <span class="pre">Restore</span></code> operation has been designed so that accounts
will be available for use as soon as the operation is started, so your
users will be able to send and receive emails even if the restore is
running.</p>
<p>Are there any other ways to do an Additional/Offsite backup of my
system?</p>
<p>There are for sure, and some of them might even be better than the one
described here. These are just guidelines that apply to the majority of
cases.</p>
</section>
</section>
<section id="multistore-information">
<span id="id29"></span><h2>Multistore Information<a class="headerlink" href="#multistore-information" title="Permalink to this headline"></a></h2>
<section id="zextras-backup-in-a-multistore-environment">
<span id="backup-ng-and-multistores"></span><h3>Zextras Backup in a Multistore Environment<a class="headerlink" href="#zextras-backup-in-a-multistore-environment" title="Permalink to this headline"></a></h3>
<section id="command-execution-in-a-multistore-environment">
<span id="id30"></span><h4>Command Execution in a Multistore Environment<a class="headerlink" href="#command-execution-in-a-multistore-environment" title="Permalink to this headline"></a></h4>
<p>The Network Administration Zimlet simplifies the management of multiple
servers: You can select a server from the Zextras Backup tab and perform
all backup operations on that server, even if you are logged into the
Zimbra Administration Console of another server.</p>
<p>Specific differences between Singlestore and Multistore environments
are:</p>
<ul class="simple">
<li><p>In a Multistore environment, <code class="docutils literal notranslate"><span class="pre">Restore</span> <span class="pre">on</span> <span class="pre">New</span> <span class="pre">Account</span></code> operations
ALWAYS create the new account in the Source account’s mailbox server</p></li>
<li><p>All operations are logged on the <strong>target</strong> server, not in the server
that launched the operation</p></li>
<li><p>If a wrong target server for an operation is chosen, Zimbra
<strong>automatically proxies</strong> the operation request to the right server</p></li>
</ul>
</section>
<section id="backup-and-restore">
<span id="id31"></span><h4>Backup and Restore<a class="headerlink" href="#backup-and-restore" title="Permalink to this headline"></a></h4>
<p>Backup and Restore in a Multistore environment will work exactly like in
a Singlestore environment.</p>
<p>The different servers will be configured and managed separately via the
Administration Zimlet, but certain operations like <em>Live Full Scan</em> and
<em>Stop All</em> Operations can be ‘broadcast’ to all the mailstores via the
<code class="docutils literal notranslate"><span class="pre">zxsuite</span></code> CLI using the <code class="docutils literal notranslate"><span class="pre">--hostname</span> <span class="pre">all_servers</span></code> option. This
applies also to Zextras Backup settings.</p>
<p>Backup and Restore operations are managed as follows:</p>
<ul class="simple">
<li><p>Smartscans can be executed on <strong>single servers</strong> via <em>the
Administration Zimlet</em> or on <strong>multiple servers</strong> via the <em>CLI</em></p></li>
<li><p>Restores can be started either from the <code class="docutils literal notranslate"><span class="pre">Accounts</span></code> tab in the
Zimbra Admin Console, from each server tab in the Zextras Backup menu
of the Administration Zimlet or via the CLI. The differences between
these methods are:</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Operation started from:</p></th>
<th class="head"><p>Options</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Accounts</span> <span class="pre">tab</span></code></p></td>
<td><p>The selected account’s restore is
automatically started in the
proper server.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Server</span> <span class="pre">tab</span></code></p></td>
<td><p>Any accounts eligible for a
restore on the selected server
can be chosen as the restore
‘source’</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CLI</span></code></p></td>
<td><p>Any account on any server can
restored, but there is no
automatic server selection.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="export-and-import">
<span id="id32"></span><h4>Export and Import<a class="headerlink" href="#export-and-import" title="Permalink to this headline"></a></h4>
<p>The Export and Import functions are the most different when performed on
a Multistore environment. Here are the basic scenarios:</p>
<section id="export-from-a-singlestore-and-import-to-a-multistore">
<span id="id33"></span><h5>Export from a Singlestore and Import to a Multistore<a class="headerlink" href="#export-from-a-singlestore-and-import-to-a-multistore" title="Permalink to this headline"></a></h5>
<p>Importing multiple accounts of a single domain to a different store will
break the consistency of ALL the items that are shared from/to a mailbox
on a different server.</p>
<p>A command in the CLI is available to fix the shares for accounts
imported on different servers, please check <a class="reference external" href="#check-fix-shares-commands">section
below</a>.</p>
</section>
<section id="export-from-a-multistore-and-import-to-a-single-or-multistore">
<span id="id34"></span><h5>Export from a Multistore and Import to a Single or Multistore<a class="headerlink" href="#export-from-a-multistore-and-import-to-a-single-or-multistore" title="Permalink to this headline"></a></h5>
<p>Two different scenarios apply here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Mirror</span></code> import: Same number of source and destination mailstores.
Each export is imported on a different server. This will break the
consistency of ALL the items that are shared from/to a mailbox on a
different server. The <code class="docutils literal notranslate"><span class="pre">doCheckShares</span></code> and <code class="docutils literal notranslate"><span class="pre">doFixShares</span></code> CLI
commands are available to check and fix share consistency (see <a class="reference external" href="#check-fix-shares-commands">the
next section</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Composite</span></code> import: Same or different number of source and
destination servers. Domains or accounts are manually imported into
different servers. This will break the consistency of ALL the items
that are shared from/to a mailbox on a different server. Also in this
case, the <code class="docutils literal notranslate"><span class="pre">doCheckShares</span></code> and <code class="docutils literal notranslate"><span class="pre">doFixShares</span></code> CLI commands are
available.</p></li>
</ul>
</section>
</section>
<section id="the-docheckshares-and-dofixshares-commands">
<span id="check-fix-shares-commands"></span><h4>The <code class="docutils literal notranslate"><span class="pre">doCheckShares</span></code> and <code class="docutils literal notranslate"><span class="pre">doFixShares</span></code> Commands<a class="headerlink" href="#the-docheckshares-and-dofixshares-commands" title="Permalink to this headline"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">doCheckShares</span></code> command will parse all share information in local
accounts and report any error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite help backup doCheckShares

Syntax:
   zxsuite backup doCheckShares


Usage example:

zxsuite backup doCheckShares
Check all shares on local accounts
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">doFixShares</span></code> will fix all share inconsistencies using a
migration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@test:~$ zxsuite help backup doFixShares

Syntax:
   zxsuite backup doFixShares {import_idmap_file}


PARAMETER LIST

NAME                    TYPE
import_idmap_file(M)    String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doFixShares idmap_file

Fixes the shares&#39; consistency after an import according to the
mapping contained in the /opt/zimbra/backup/ng/idmap_file
</pre></div>
</div>
</section>
</section>
</section>
<section id="operation-queue-and-queue-management">
<span id="id35"></span><h2>Operation Queue and Queue Management<a class="headerlink" href="#operation-queue-and-queue-management" title="Permalink to this headline"></a></h2>
<section id="zextras-backups-operation-queue">
<span id="id36"></span><h3>Zextras Backup’s Operation Queue<a class="headerlink" href="#zextras-backups-operation-queue" title="Permalink to this headline"></a></h3>
<p>Every time a Zextras Backup operation is started, either manually or
through scheduling, it is enqueued in a dedicated, unprioritized FIFO
queue. Each operation is executed as soon as any preceding operation is
dequeued (either because it has been completed or terminated).</p>
<p>The queue system affects the following operations:</p>
<ul class="simple">
<li><p>External backup</p></li>
<li><p>All restore operations</p></li>
<li><p>Smartscan</p></li>
</ul>
<p>Changes to Zextras Backup’s configuratito on are not enqueued and are
applied immediately.</p>
</section>
<section id="operation-queue-management">
<span id="id37"></span><h3>Operation Queue Management<a class="headerlink" href="#operation-queue-management" title="Permalink to this headline"></a></h3>
<section id="through-the-administration-console">
<span id="id38"></span><h4>Through the Administration Console<a class="headerlink" href="#through-the-administration-console" title="Permalink to this headline"></a></h4>
<section id="viewing-the-queue">
<span id="id39"></span><h5>Viewing the Queue<a class="headerlink" href="#viewing-the-queue" title="Permalink to this headline"></a></h5>
<p>To view the operation queue, access the <code class="docutils literal notranslate"><span class="pre">Notifications</span></code> tab in the
Administration Zimlet and click the <code class="docutils literal notranslate"><span class="pre">Operation</span> <span class="pre">Queue</span></code> button.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Administration Zimlet displays operations queued both by Zextras
Backup and Zextras Powerstore in a single view. This is just a design
choice, as the two queues are completely separate, meaning that one
Zextras Backup operation and one Zextras Powerstore operation can be
running at the same time.</p>
</div>
</section>
<section id="emptying-the-queue">
<span id="id40"></span><h5>Emptying the Queue<a class="headerlink" href="#emptying-the-queue" title="Permalink to this headline"></a></h5>
<p>To stop the current operation and empty Zextras Backup’s operation
queue, enter the <code class="docutils literal notranslate"><span class="pre">Zextras</span> <span class="pre">Backup</span></code> tab in the Administration Zimlet and
click the <code class="docutils literal notranslate"><span class="pre">Stop</span> <span class="pre">all</span> <span class="pre">Operations</span></code> button.</p>
</section>
</section>
<section id="through-the-cli">
<span id="id41"></span><h4>Through the CLI<a class="headerlink" href="#through-the-cli" title="Permalink to this headline"></a></h4>
<section id="viewing-the-queue-2">
<span id="id42"></span><h5>Viewing the Queue<a class="headerlink" href="#viewing-the-queue-2" title="Permalink to this headline"></a></h5>
<p>To view Zextras Backup’s operation queue, use the <code class="docutils literal notranslate"><span class="pre">getAllOperations</span></code>
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@server:~$ zxsuite help backup getAllOperations

Syntax:
   zxsuite backup getAllOperations [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME          TYPE       EXPECTED VALUES    DEFAULT
verbose(O)    Boolean    true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup getAllOperations
Shows all running and queued operations
</pre></div>
</div>
</section>
<section id="emptying-the-queue-2">
<span id="id43"></span><h5>Emptying the Queue<a class="headerlink" href="#emptying-the-queue-2" title="Permalink to this headline"></a></h5>
<p>To stop the current operation and empty Zextras Backup’s operation
queue, use the <code class="docutils literal notranslate"><span class="pre">doStopAllOperations</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@mail:~$ zxsuite help backup doStopAllOperations

Syntax:
   zxsuite backup doStopAllOperations


Usage example:

zxsuite backup doStopAllOperations
Stops all running operations
</pre></div>
</div>
</section>
<section id="removing-a-single-operation-from-the-queue">
<span id="id44"></span><h5>Removing a Single Operation from the Queue<a class="headerlink" href="#removing-a-single-operation-from-the-queue" title="Permalink to this headline"></a></h5>
<p>To stop the current operation or to remove a specific operation from the
queue, use the <code class="docutils literal notranslate"><span class="pre">doStopOperation</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>zimbra@mail:~$ zxsuite help backup doStopOperation

Syntax:
   zxsuite backup doStopOperation {operation_uuid}


PARAMETER LIST

NAME                 TYPE
operation_uuid(M)    Uiid

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doStopOperation 30ed9eb9-eb28-4ca6-b65e-9940654b8601
Stops operation with id = 30ed9eb9-eb28-4ca6-b65e-9940654b8601
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="cos-level-backup-management">
<span id="id45"></span><h2>COS-level Backup Management<a class="headerlink" href="#cos-level-backup-management" title="Permalink to this headline"></a></h2>
<section id="what-is-cos-level-backup-management">
<span id="id46"></span><h3>What is COS-level Backup Management?<a class="headerlink" href="#what-is-cos-level-backup-management" title="Permalink to this headline"></a></h3>
<p>COS-level Backup Management allows the administrator to disable ALL
Zextras Backup functions for a whole Class of Service to lower storage
usage.</p>
</section>
<section id="how-does-cos-level-backup-management-work">
<span id="id47"></span><h3>How Does COS-level Backup Management Work?<a class="headerlink" href="#how-does-cos-level-backup-management-work" title="Permalink to this headline"></a></h3>
<section id="what-happens-if-i-disable-the-zextras-backup-module-for-a-class-of-service">
<span id="id48"></span><h4>What happens if I disable the Zextras Backup Module for a Class of Service?<a class="headerlink" href="#what-happens-if-i-disable-the-zextras-backup-module-for-a-class-of-service" title="Permalink to this headline"></a></h4>
<ul class="simple">
<li><p>The Real Time Scanner will ignore all accounts in the COS.</p></li>
<li><p>The Export Backup function WILL NOT EXPORT accounts in the COS.</p></li>
<li><p>Accounts in the COS will be treated as <code class="docutils literal notranslate"><span class="pre">Deleted</span></code> by the backup
system. This means that after the data retention period expires, all
data for such accounts will be purged from the backup store.
Re-enabling the backup for a Class of Service will reset this.</p></li>
</ul>
</section>
<section id="how-is-the-backup-enabled-backup-disabled-information-saved">
<span id="how-is-the-backup-enabledbackup-disabled-information-saved"></span><h4>How is the <code class="docutils literal notranslate"><span class="pre">backup</span> <span class="pre">enabled</span></code>/<code class="docutils literal notranslate"><span class="pre">backup</span> <span class="pre">disabled</span></code> information saved?<a class="headerlink" href="#how-is-the-backup-enabled-backup-disabled-information-saved" title="Permalink to this headline"></a></h4>
<p>Disabling the backup for a Class of Service will add the following
marker to the Class of Service’s <code class="docutils literal notranslate"><span class="pre">Notes</span></code> field:
<strong>${ZxBackup_Disabled}</strong></p>
<p>While the Notes field remains fully editable and usable, changing or
deleting this marker will re-enable the backup for the COS.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="restorestrategies.html" class="btn btn-neutral float-left" title="Zextras Backup Restore Strategies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mobile.html" class="btn btn-neutral float-right" title="Zextras Mobile" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The Zextras Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>